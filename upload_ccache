#!/bin/bash

cd /tmp

up () {
  if [ -e $1 ]; then
  echo "uploading $1"
	curl --upload-file $1 https://temp.sh/$(basename $1); echo
	# 14 days, 10 GB limit
  fi
}

echo "|| Compressing CCACHE ||"
time 7za a -tzip -v3g ccache_backup.zip /tmp/ccache/* -sdel

# upload all parts
echo "|| Uploading CCACHE ||"
for i in /tmp/ccache_backup.zip.*; do
     time up ${i}
done

# clean storage
rm -rf /tmp/*
